<!DOCTYPE HTML>
<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8" />
<title>dbo.FilterDataByDatabase</title>
<script src="../../../../../../scripts/jquery-1.12.0.min.js" type="text/javascript"></script>
<script src="../../../../../../scripts/bootstrap.min.js" type="text/javascript"></script>
<script src="../../../../../../scripts/clipboard.min.js" type="text/javascript"></script>
<script src="../../../../../../scripts/main.js" type="text/javascript"></script>
<link rel="stylesheet" href="../../../../../../styles/bootstrap/Default.css" type="text/css">
<link rel="stylesheet" href="../../../../../../styles/main.css" type="text/css">
<link rel="stylesheet" href="../../../../../../styles/svg.css" type="text/css">
</head>
<body class="watermark">

  <div class="page-wrap">
    <div class="header">
      <div class="row">
        <div class="col-xs-12">
          <ol class="breadcrumb">
            <li><a href="../../../../../../startpage.html" data-mapping-enabled="true">Project</a></li>
            <li><a href="../../../../../../Servers\Servers.html" data-mapping-enabled="true">Servers</a></li>
            <li><a href="../../../../../../Servers\NAVISAF5.DATABASE.WINDOWS.NET\NAVISAF5.DATABASE.WINDOWS.NET.html" data-mapping-enabled="true">NAVISAF5.DATABASE.WINDOWS.NET</a></li>
            <li><a href="../../../../../../Servers\NAVISAF5.DATABASE.WINDOWS.NET\UserDatabases\UserDatabases.html" data-mapping-enabled="true">User databases</a></li>
            <li><a href="../../../../../../Servers\NAVISAF5.DATABASE.WINDOWS.NET\UserDatabases\GoApp_Dev\GoApp_Dev.html" data-mapping-enabled="true">GoApp_Dev</a></li>
            <li><a href="../../../../../../Servers\NAVISAF5.DATABASE.WINDOWS.NET\UserDatabases\GoApp_Dev\Programmability\Programmability.html" data-mapping-enabled="true">Programmability</a></li>
            <li><a href="../../../../../../Servers\NAVISAF5.DATABASE.WINDOWS.NET\UserDatabases\GoApp_Dev\Programmability\Procedures\Procedures.html" data-mapping-enabled="true">Stored Procedures</a></li>
            <li class="active">dbo.FilterDataByDatabase</li>
          </ol>
        </div>
      </div>
      <div class="row">
        <div class="title col-xs-12">
          <div><svg class="inline-middle image-large light" data-toggle="tooltip" title="dbo.FilterDataByDatabase" data-original-title="dbo.FilterDataByDatabase">
            <svg viewBox="0 0 16 16"><path d="M15.997 15.998h-16v-16h16v16z" class="vs_output" /><path d="M7.464 10.664H3.197V9.598h4.267v1.066zm0-2.133H3.197V7.464h4.267v1.067zm5.333 4.267h-6.4V11.73h6.4v1.067zm-1.066-2.134h-3.2V9.598h3.2v1.066zm-6.4 2.134H3.197V11.73h2.134v1.067zm5.333-4.267H8.531V7.464h2.133v1.067zm-3.2-2.133H3.197V5.33h4.267v1.067zm6.4 7.466H2.131v-9.6h11.733v9.6zm-12.8 1.067h13.867V1.064H1.064v13.867z" class="vs_background" /><path d="M12.797 12.798h-6.4V11.73h6.4v1.067zm-7.466 0H3.197V11.73h2.134v1.067zm-2.134-3.2l4.267.02v1.046H3.197V9.598zm0-2.114l4.267-.02v1.067H3.197V7.484zm0-2.153h4.267v1.067H3.197V5.33zm5.334 4.267h3.2v1.066h-3.2V9.598zm0-2.134h2.133v1.067H8.531V7.464zm-6.4 6.4h11.733v-9.6H2.131v9.6z" class="vs_foreground" /></svg></svg><h1 class="inline-middle">dbo.FilterDataByDatabase</h1>
            <div class="dropdown actions-btn-wrap">
              <button type="button" class="btn btn-default actions-btn" data-toggle="dropdown"><span class="icon-actions icon-small actions-btn-span"></span></button>
              <ul class="dropdown-menu dropdown-menu-right">
                <li><a id="CollapseAll" href="#">Collapse All</a></li>
                <li><a id="ExpandAll" href="#">Expand All</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="content">
      <div id="Description" class="panel panel-default">
        <div class="panel-heading">
          <span class="icon-bottom inline-middle expanded icon-small"></span>
          <span class="icon-right inline-middle collapsed icon-small" style="display:none"></span>
          <h2 class="inline-middle">Description</h2>
        </div>
        <div class="panel-collapse collapse in">
          <div class="panel-body">
            <span>Procedimiento almacenado que filtra la información de datos GPS que se va a enviar al DIG Server en el formato esperado.</span>
          </div>
        </div>
      </div>
      <div id="SqlScript" class="panel panel-default">
        <div class="panel-heading">
          <span class="icon-bottom inline-middle expanded icon-small"></span>
          <span class="icon-right inline-middle collapsed icon-small" style="display:none"></span>
          <h2 class="inline-middle">SQL Script</h2>
        </div>
        <div class="panel-collapse collapse in">
          <div class="panel-body">
            <div class="zero-clipboard">
              <span class="btn-clipboard btn-default panel-default" data-clipboard-action="copy" data-clipboard-target=".sqlscript" data-toggle="tooltip" title="Copy to clipboard">Copy</span></div><div class="sqlscript  panel-default" style="word-wrap: break-word; padding-right:60px">
              <font color="#0000ff">SET</font>&nbsp;<font color="#0000ff">QUOTED_IDENTIFIER</font><font color="#808080">,</font>&nbsp;<font color="#0000ff">ANSI_NULLS</font>&nbsp;<font color="#0000ff">ON</font><br /><font color="#0000ff">GO</font><br /><font color="#0000ff">CREATE</font>&nbsp;<font color="#808080">OR</font>&nbsp;<font color="#0000ff">ALTER</font>&nbsp;<font color="#0000ff">PROCEDURE</font>&nbsp;<font color="#000000">dbo</font><font color="#808080">.</font><font color="#000000">FilterDataByDatabase</font><br /><font color="#0000ff">AS</font><br /><font color="#000000"></font><br /><font color="#0000ff">BEGIN</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">SET</font>&nbsp;<font color="#0000ff">NOCOUNT</font>&nbsp;<font color="#0000ff">ON</font><font color="#808080">;</font><br /><font color="#000000"></font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">DECLARE</font>&nbsp;<font color="#008080">@boolValue</font>&nbsp;<font color="#0000ff">BIT</font><font color="#808080">;</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">SET</font>&nbsp;<font color="#008080">@boolValue</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#000000">0</font><font color="#808080">;</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">DECLARE</font>&nbsp;<font color="#008080">@LoadGeneratorBD</font>&nbsp;<font color="#0000ff">NVARCHAR</font><font color="#808080">(</font><font color="#000000">100</font><font color="#808080">)</font><font color="#808080">;</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">DECLARE</font>&nbsp;<font color="#008080">@DriverTripID</font>&nbsp;<font color="#0000ff">INT</font><font color="#808080">;</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">DECLARE</font>&nbsp;<font color="#008080">@sql</font>&nbsp;<font color="#0000ff">NVARCHAR</font><font color="#808080">(</font><font color="#ff00ff">MAX</font><font color="#808080">)</font><font color="#808080">;</font><br /><font color="#000000"></font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">DECLARE</font>&nbsp;<font color="#008080">@Speed</font>&nbsp;<font color="#0000ff">INT</font><font color="#808080">;</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">DECLARE</font>&nbsp;<font color="#008080">@HDOP</font>&nbsp;<font color="#0000ff">INT</font><font color="#808080">;</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">DECLARE</font>&nbsp;<font color="#008080">@SendRange</font>&nbsp;<font color="#0000ff">INT</font><font color="#808080">;</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">DECLARE</font>&nbsp;<font color="#008080">@RDPGuideIndicator</font>&nbsp;<font color="#0000ff">FLOAT</font><font color="#808080">;</font><br /><font color="#000000"></font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">SELECT</font>&nbsp;<font color="#008080">@Speed</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#000000">Speed</font><font color="#808080">,</font>&nbsp;<font color="#008080">@HDOP</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#000000">HDOP</font><font color="#808080">,</font>&nbsp;<font color="#008080">@SendRange</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#000000">SendRange</font><font color="#808080">,</font>&nbsp;<font color="#008080">@RDPGuideIndicator</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#000000">RDPGuideIndicator</font>&nbsp;<font color="#0000ff">FROM</font>&nbsp;<font color="#000000">dbo</font><font color="#808080">.</font><font color="#0000ff">Settings</font><font color="#808080">;</font><br /><font color="#000000"></font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">-- Cursor para iterar sobre los distintos valores de LoadGeneratorBD y DriverTripID</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">DECLARE</font>&nbsp;<font color="#000000">cursor_LoadGeneratorBD</font>&nbsp;<font color="#0000ff">CURSOR</font>&nbsp;<font color="#0000ff">FOR</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">SELECT</font>&nbsp;<font color="#0000ff">DISTINCT</font>&nbsp;<font color="#000000">LoadGeneratorBD</font><font color="#808080">,</font>&nbsp;<font color="#000000">DriverTripID</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">FROM</font>&nbsp;<font color="#000000">dbo</font><font color="#808080">.</font><font color="#000000">DriverTrip</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">WHERE</font>&nbsp;<font color="#000000">LoadGeneratorBD</font>&nbsp;<font color="#808080">IS</font>&nbsp;<font color="#808080">NOT</font>&nbsp;<font color="#808080">NULL</font><font color="#808080">;</font><br /><font color="#000000"></font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">-- Abrir el cursor</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">OPEN</font>&nbsp;<font color="#000000">cursor_LoadGeneratorBD</font><font color="#808080">;</font><br /><font color="#000000"></font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">-- Inicializar la variable que almacenará los valores actuales de LoadGeneratorBD y DriverTripID</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">FETCH</font>&nbsp;<font color="#0000ff">NEXT</font>&nbsp;<font color="#0000ff">FROM</font>&nbsp;<font color="#000000">cursor_LoadGeneratorBD</font>&nbsp;<font color="#0000ff">INTO</font>&nbsp;<font color="#008080">@LoadGeneratorBD</font><font color="#808080">,</font>&nbsp;<font color="#008080">@DriverTripID</font><font color="#808080">;</font><br /><font color="#000000"></font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">-- Recorrer cada valor de LoadGeneratorBD y DriverTripID</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">WHILE</font>&nbsp;<font color="#008080">@@FETCH_STATUS</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#000000">0</font><br />&nbsp;<font color="#0000ff">BEGIN</font><br />&nbsp;&nbsp;&nbsp;<font color="#0000ff">DECLARE</font>&nbsp;<font color="#008080">@rowCount</font>&nbsp;<font color="#0000ff">INT</font><font color="#808080">;</font><br />&nbsp;&nbsp;&nbsp;<font color="#008000">-- Obtener el valor máximo de GPSDataTime para el flag = 2 por DriverTripID</font><br />&nbsp;&nbsp;&nbsp;<font color="#0000ff">DECLARE</font>&nbsp;<font color="#008080">@MaxGpsDataTime</font>&nbsp;<font color="#0000ff">DATETIME</font><font color="#808080">;</font><br />&nbsp;&nbsp;&nbsp;<font color="#0000ff">SELECT</font>&nbsp;<font color="#008080">@MaxGpsDataTime</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#ff00ff">MAX</font><font color="#808080">(</font><font color="#000000">Gt</font><font color="#808080">.</font><font color="#000000">GPSDataTime</font><font color="#808080">)</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">FROM</font>&nbsp;<font color="#000000">dbo</font><font color="#808080">.</font><font color="#000000">GpsData</font>&nbsp;<font color="#000000">Gt</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">WHERE</font>&nbsp;<font color="#000000">Gt</font><font color="#808080">.</font><font color="#000000">Flag</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#000000">2</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080">AND</font>&nbsp;<font color="#000000">Gt</font><font color="#808080">.</font><font color="#000000">DriverTripID</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#008080">@DriverTripID</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080">AND</font>&nbsp;<font color="#000000">Gt</font><font color="#808080">.</font><font color="#000000">GPSDataTime</font>&nbsp;<font color="#808080">IS</font>&nbsp;<font color="#808080">NOT</font>&nbsp;<font color="#808080">NULL</font><font color="#808080">;</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">--AND Gt.isOnGeoTabServer = 0;</font><br /><font color="#000000"></font><br />&nbsp;&nbsp;&nbsp;<font color="#008000">--PRINT 'LoadGeneratorBD: ' + @LoadGeneratorBD;</font><br />&nbsp;&nbsp;&nbsp;<font color="#008000">--PRINT 'DriverTripID: ' + CAST(@DriverTripID AS NVARCHAR);</font><br />&nbsp;&nbsp;&nbsp;<font color="#008000">--PRINT 'MaxGpsDataTime: ' + ISNULL(CONVERT(NVARCHAR, @MaxGpsDataTime, 121), 'NULL');</font><br /><font color="#000000"></font><br />&nbsp;&nbsp;&nbsp;<font color="#008000">-- Verificar existencia de registros</font><br />&nbsp;&nbsp;&nbsp;<font color="#0000ff">SELECT</font>&nbsp;<font color="#008080">@rowCount</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#ff00ff">COUNT</font><font color="#808080">(</font><font color="#808080">*</font><font color="#808080">)</font><br />&nbsp;&nbsp;&nbsp;<font color="#0000ff">FROM</font>&nbsp;<font color="#000000">dbo</font><font color="#808080">.</font><font color="#000000">DriverTrip</font>&nbsp;<font color="#0000ff">D</font><br />&nbsp;&nbsp;&nbsp;<font color="#808080">JOIN</font>&nbsp;<font color="#000000">dbo</font><font color="#808080">.</font><font color="#000000">GpsData</font>&nbsp;<font color="#000000">Gt</font>&nbsp;<font color="#0000ff">ON</font>&nbsp;<font color="#0000ff">D</font><font color="#808080">.</font><font color="#000000">DriverTripID</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#000000">Gt</font><font color="#808080">.</font><font color="#000000">DriverTripID</font><br />&nbsp;&nbsp;&nbsp;<font color="#808080">JOIN</font>&nbsp;<font color="#000000">dbo</font><font color="#808080">.</font><font color="#000000">Vehicle</font>&nbsp;<font color="#000000">V</font>&nbsp;<font color="#0000ff">ON</font>&nbsp;<font color="#0000ff">D</font><font color="#808080">.</font><font color="#000000">VehicleID</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#000000">V</font><font color="#808080">.</font><font color="#000000">VehicleID</font><br />&nbsp;&nbsp;&nbsp;<font color="#0000ff">WHERE</font>&nbsp;<font color="#000000">Gt</font><font color="#808080">.</font><font color="#000000">isOnGeoTabServer</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#000000">0</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080">AND</font>&nbsp;<font color="#0000ff">D</font><font color="#808080">.</font><font color="#000000">LoadGeneratorBD</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#008080">@LoadGeneratorBD</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080">AND</font>&nbsp;<font color="#0000ff">D</font><font color="#808080">.</font><font color="#000000">DriverTripID</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#008080">@DriverTripID</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080">AND</font>&nbsp;<font color="#808080">(</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080">(</font><font color="#000000">Gt</font><font color="#808080">.</font><font color="#000000">Flag</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#000000">0</font>&nbsp;<font color="#808080">AND</font>&nbsp;<font color="#000000">Gt</font><font color="#808080">.</font><font color="#000000">isIgnitionOn</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#000000">1</font><font color="#808080">)</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080">OR</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080">(</font><font color="#000000">Gt</font><font color="#808080">.</font><font color="#000000">Flag</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#000000">1</font>&nbsp;<font color="#808080">AND</font>&nbsp;<font color="#000000">Gt</font><font color="#808080">.</font><font color="#000000">isIgnitionOn</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#000000">1</font>&nbsp;<font color="#808080">AND</font>&nbsp;<font color="#000000">Gt</font><font color="#808080">.</font><font color="#000000">Speed</font>&nbsp;<font color="#808080">></font>&nbsp;<font color="#008080">@Speed</font>&nbsp;<font color="#808080">AND</font>&nbsp;<font color="#000000">Gt</font><font color="#808080">.</font><font color="#000000">HDOP</font>&nbsp;<font color="#808080"><</font>&nbsp;<font color="#008080">@HDOP</font>&nbsp;<font color="#808080">AND</font>&nbsp;<font color="#000000">Gt</font><font color="#808080">.</font><font color="#000000">RDPSendCriteria</font>&nbsp;<font color="#808080">></font><font color="#808080">=</font>&nbsp;<font color="#008080">@RDPGuideIndicator</font><font color="#808080">)</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080">OR</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080">(</font><font color="#000000">Gt</font><font color="#808080">.</font><font color="#000000">Flag</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#000000">2</font>&nbsp;<font color="#808080">AND</font>&nbsp;<font color="#000000">Gt</font><font color="#808080">.</font><font color="#000000">isIgnitionOn</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#000000">0</font><font color="#808080">)</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080">)</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#808080">AND</font>&nbsp;<font color="#000000">Gt</font><font color="#808080">.</font><font color="#000000">GPSDataTime</font>&nbsp;<font color="#808080"><</font><font color="#808080">=</font>&nbsp;<font color="#ff00ff">ISNULL</font><font color="#808080">(</font><font color="#008080">@MaxGpsDataTime</font><font color="#808080">,</font>&nbsp;<font color="#000000">Gt</font><font color="#808080">.</font><font color="#000000">GPSDataTime</font><font color="#808080">)</font><font color="#808080">;</font><br /><font color="#000000"></font><br />&nbsp;&nbsp;&nbsp;<font color="#008000">-- Ejecutar la consulta dinámica solo si hay al menos un registro</font><br />&nbsp;&nbsp;&nbsp;<font color="#0000ff">IF</font>&nbsp;<font color="#008080">@rowCount</font>&nbsp;<font color="#808080">></font>&nbsp;<font color="#000000">0</font><br /><font color="#000000"></font><br />&nbsp;&nbsp;&nbsp;<font color="#0000ff">BEGIN</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">-- Construir la consulta para seleccionar los registros</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">SET</font>&nbsp;<font color="#008080">@sql</font>&nbsp;<font color="#808080">=</font>&nbsp;<font color="#ff0000">'<br />&nbsp;&nbsp;&nbsp;&nbsp;				SELECT TOP (@SendRange)<br />&nbsp;&nbsp;&nbsp;&nbsp;					D.DriverTripID,<br />&nbsp;&nbsp;&nbsp;&nbsp;					D.LoadGeneratorBD,<br />&nbsp;&nbsp;&nbsp;&nbsp;					Gt.GPSDataTime AS dateTime,<br />&nbsp;&nbsp;&nbsp;&nbsp;					V.VehicleSerialNo AS serialNo,<br />&nbsp;&nbsp;&nbsp;&nbsp;					''GpsRecord'' AS type,<br />&nbsp;&nbsp;&nbsp;&nbsp;					@boolValue AS isAuxiliary1On,<br />&nbsp;&nbsp;&nbsp;&nbsp;					@boolValue AS isAuxiliary2On,<br />&nbsp;&nbsp;&nbsp;&nbsp;					@boolValue AS isAuxiliary3On,<br />&nbsp;&nbsp;&nbsp;&nbsp;					@boolValue AS isAuxiliary4On,<br />&nbsp;&nbsp;&nbsp;&nbsp;					@boolValue AS isAuxiliary5On,<br />&nbsp;&nbsp;&nbsp;&nbsp;					@boolValue AS isAuxiliary6On,<br />&nbsp;&nbsp;&nbsp;&nbsp;					@boolValue AS isAuxiliary7On,<br />&nbsp;&nbsp;&nbsp;&nbsp;					@boolValue AS isAuxiliary8On,<br />&nbsp;&nbsp;&nbsp;&nbsp;					Gt.isGpsValid,<br />&nbsp;&nbsp;&nbsp;&nbsp;					Gt.isIgnitionOn,<br />&nbsp;&nbsp;&nbsp;&nbsp;					Gt.Lat AS Latitude,<br />&nbsp;&nbsp;&nbsp;&nbsp;					Gt.Long AS Longitude,<br />&nbsp;&nbsp;&nbsp;&nbsp;					Gt.Speed AS Speed<br />&nbsp;&nbsp;&nbsp;&nbsp;				FROM dbo.DriverTrip D<br />&nbsp;&nbsp;&nbsp;&nbsp;				JOIN dbo.GpsData Gt ON D.DriverTripID = Gt.DriverTripID<br />&nbsp;&nbsp;&nbsp;&nbsp;				JOIN dbo.Vehicle V ON D.VehicleID = V.VehicleID<br />&nbsp;&nbsp;&nbsp;&nbsp;				WHERE Gt.isOnGeoTabServer = 0<br />&nbsp;&nbsp;&nbsp;&nbsp;					AND D.LoadGeneratorBD = @LoadGeneratorBD<br />&nbsp;&nbsp;&nbsp;&nbsp;					AND D.DriverTripID = @DriverTripID<br />&nbsp;&nbsp;&nbsp;&nbsp;					AND (<br />&nbsp;&nbsp;&nbsp;&nbsp;						(Gt.Flag = 0 AND Gt.isIgnitionOn = 1)<br />&nbsp;&nbsp;&nbsp;&nbsp;						OR<br />&nbsp;&nbsp;&nbsp;&nbsp;						(Gt.Flag = 1 AND Gt.isIgnitionOn = 1 AND Gt.Speed &gt; @Speed AND Gt.HDOP &lt; @HDOP AND Gt.RDPSendCriteria &gt;= @RDPGuideIndicator)<br />&nbsp;&nbsp;&nbsp;&nbsp;						OR<br />&nbsp;&nbsp;&nbsp;&nbsp;						(Gt.Flag = 2 AND Gt.isIgnitionOn = 0)<br />&nbsp;&nbsp;&nbsp;&nbsp;					)<br />&nbsp;&nbsp;&nbsp;&nbsp;					AND Gt.GPSDataTime &lt;= ISNULL(@MaxGpsDataTime, Gt.GPSDataTime)<br />&nbsp;&nbsp;&nbsp;&nbsp;				ORDER BY Gt.GPSDataTime;'</font><font color="#808080">;</font><br /><font color="#000000"></font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">-- Imprimir la consulta generada para verificarla</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">--PRINT @sql;</font><br /><font color="#000000"></font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">-- Ejecutar la consulta</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">EXEC</font>&nbsp;<font color="#000000">sp_executesql</font>&nbsp;<font color="#008080">@sql</font><font color="#808080">,</font>&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#ff0000">N'@LoadGeneratorBD NVARCHAR(100), @DriverTripID INT, @boolValue BIT, @Speed INT, @HDOP INT, @SendRange INT, @RDPGuideIndicator FLOAT, @MaxGpsDataTime DATETIME'</font><font color="#808080">,</font>&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008080">@LoadGeneratorBD</font><font color="#808080">,</font>&nbsp;<font color="#008080">@DriverTripID</font><font color="#808080">,</font>&nbsp;<font color="#008080">@boolValue</font><font color="#808080">,</font>&nbsp;<font color="#008080">@Speed</font><font color="#808080">,</font>&nbsp;<font color="#008080">@HDOP</font><font color="#808080">,</font>&nbsp;<font color="#008080">@SendRange</font><font color="#808080">,</font>&nbsp;<font color="#008080">@RDPGuideIndicator</font><font color="#808080">,</font>&nbsp;<font color="#008080">@MaxGpsDataTime</font><font color="#808080">;</font><br />&nbsp;&nbsp;&nbsp;<font color="#0000ff">END</font><font color="#808080">;</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">-- Obtener el siguiente valor de LoadGeneratorBD y DriverTripID</font><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">FETCH</font>&nbsp;<font color="#0000ff">NEXT</font>&nbsp;<font color="#0000ff">FROM</font>&nbsp;<font color="#000000">cursor_LoadGeneratorBD</font>&nbsp;<font color="#0000ff">INTO</font>&nbsp;<font color="#008080">@LoadGeneratorBD</font><font color="#808080">,</font>&nbsp;<font color="#008080">@DriverTripID</font><font color="#808080">;</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">END</font><font color="#808080">;</font><br /><font color="#000000"></font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#008000">-- Cerrar el cursor</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">CLOSE</font>&nbsp;<font color="#000000">cursor_LoadGeneratorBD</font><font color="#808080">;</font><br />&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000ff">DEALLOCATE</font>&nbsp;<font color="#000000">cursor_LoadGeneratorBD</font><font color="#808080">;</font><br />&nbsp;<br />&nbsp;<font color="#008000">--EXEC FilterDataByDatabase</font><br /><font color="#0000ff">END</font><font color="#808080">;</font><br /><font color="#0000ff">GO</font><br /><font color="#000000"></font><br /><font color="#0000ff">EXEC</font>&nbsp;<font color="#000000">sys</font><font color="#808080">.</font><font color="#800000">sp_addextendedproperty</font>&nbsp;<font color="#ff0000">N'MS_Description'</font><font color="#808080">,</font>&nbsp;<font color="#ff0000">N'Procedimiento almacenado que filtra la información de datos GPS que se va a enviar al DIG Server en el formato esperado.'</font><font color="#808080">,</font>&nbsp;<font color="#ff0000">'SCHEMA'</font><font color="#808080">,</font>&nbsp;<font color="#ff0000">N'dbo'</font><font color="#808080">,</font>&nbsp;<font color="#ff0000">'PROCEDURE'</font><font color="#808080">,</font>&nbsp;<font color="#ff0000">N'FilterDataByDatabase'</font><br /><font color="#0000ff">GO</font></div>
          </div>
        </div>
      </div>
      <div id="DependsOn" class="panel panel-default">
        <div class="panel-heading">
          <span class="icon-bottom inline-middle expanded icon-small"></span>
          <span class="icon-right inline-middle collapsed icon-small" style="display:none"></span>
          <h2 class="inline-middle">Depends On</h2>
          <span class="badge inline-middle">3</span>
        </div>
        <div class="panel-collapse collapse in">
          <div class="panel-body">
            <ul class="items-list">
              <li><a href="../../../../../../Servers\NAVISAF5.DATABASE.WINDOWS.NET\UserDatabases\GoApp_Dev\Tables\dbo.DriverTrip.html" data-mapping-enabled="true"><svg class="image-small light" data-toggle="tooltip" title="Table" data-original-title="Table">
              <svg viewBox="0 0 16 16"><path d="M16 15.5H0V.567h16V15.5z" class="vs_output"/><path d="M13.867 6.967h-3.2V4.833h3.2v2.134zm0 3.2h-3.2V8.033h3.2v2.134zm0 3.2h-3.2v-2.134h3.2v2.134zM9.6 6.967H6.4V4.833h3.2v2.134zm0 3.2H6.4V8.033h3.2v2.134zm0 3.2H6.4v-2.134h3.2v2.134zm-4.267-6.4h-3.2V4.833h3.2v2.134zm0 3.2h-3.2V8.033h3.2v2.134zm0 3.2h-3.2v-2.134h3.2v2.134zm-4.266 1.066h13.866v-12.8H1.067v12.8z" class="vs_background"/><path d="M5.333 11.233h-3.2v2.134h3.2v-2.134zm4.267 0H6.4v2.134h3.2v-2.134zm4.267 0h-3.2v2.134h3.2v-2.134zm-8.534-3.2h-3.2v2.134h3.2V8.033zm0-3.2h-3.2v2.134h3.2V4.833zm4.267 3.2H6.4v2.134h3.2V8.033zm0-3.2H6.4v2.134h3.2V4.833zm4.267 3.2h-3.2v2.134h3.2V8.033zm0-1.066h-3.2V4.833h3.2v2.134z" class="vs_foreground"/></svg></svg><span>dbo.DriverTrip</span></a></li>
              <li><a href="../../../../../../Servers\NAVISAF5.DATABASE.WINDOWS.NET\UserDatabases\GoApp_Dev\Tables\dbo.GPSData.html" data-mapping-enabled="true"><svg class="image-small light" data-toggle="tooltip" title="Table" data-original-title="Table">
              <svg viewBox="0 0 16 16"><path d="M16 15.5H0V.567h16V15.5z" class="vs_output"/><path d="M13.867 6.967h-3.2V4.833h3.2v2.134zm0 3.2h-3.2V8.033h3.2v2.134zm0 3.2h-3.2v-2.134h3.2v2.134zM9.6 6.967H6.4V4.833h3.2v2.134zm0 3.2H6.4V8.033h3.2v2.134zm0 3.2H6.4v-2.134h3.2v2.134zm-4.267-6.4h-3.2V4.833h3.2v2.134zm0 3.2h-3.2V8.033h3.2v2.134zm0 3.2h-3.2v-2.134h3.2v2.134zm-4.266 1.066h13.866v-12.8H1.067v12.8z" class="vs_background"/><path d="M5.333 11.233h-3.2v2.134h3.2v-2.134zm4.267 0H6.4v2.134h3.2v-2.134zm4.267 0h-3.2v2.134h3.2v-2.134zm-8.534-3.2h-3.2v2.134h3.2V8.033zm0-3.2h-3.2v2.134h3.2V4.833zm4.267 3.2H6.4v2.134h3.2V8.033zm0-3.2H6.4v2.134h3.2V4.833zm4.267 3.2h-3.2v2.134h3.2V8.033zm0-1.066h-3.2V4.833h3.2v2.134z" class="vs_foreground"/></svg></svg><span>dbo.GPSData</span></a></li>
              <li><a href="../../../../../../Servers\NAVISAF5.DATABASE.WINDOWS.NET\UserDatabases\GoApp_Dev\Tables\dbo.Vehicle.html" data-mapping-enabled="true"><svg class="image-small light" data-toggle="tooltip" title="Table" data-original-title="Table">
              <svg viewBox="0 0 16 16"><path d="M16 15.5H0V.567h16V15.5z" class="vs_output"/><path d="M13.867 6.967h-3.2V4.833h3.2v2.134zm0 3.2h-3.2V8.033h3.2v2.134zm0 3.2h-3.2v-2.134h3.2v2.134zM9.6 6.967H6.4V4.833h3.2v2.134zm0 3.2H6.4V8.033h3.2v2.134zm0 3.2H6.4v-2.134h3.2v2.134zm-4.267-6.4h-3.2V4.833h3.2v2.134zm0 3.2h-3.2V8.033h3.2v2.134zm0 3.2h-3.2v-2.134h3.2v2.134zm-4.266 1.066h13.866v-12.8H1.067v12.8z" class="vs_background"/><path d="M5.333 11.233h-3.2v2.134h3.2v-2.134zm4.267 0H6.4v2.134h3.2v-2.134zm4.267 0h-3.2v2.134h3.2v-2.134zm-8.534-3.2h-3.2v2.134h3.2V8.033zm0-3.2h-3.2v2.134h3.2V4.833zm4.267 3.2H6.4v2.134h3.2V8.033zm0-3.2H6.4v2.134h3.2V4.833zm4.267 3.2h-3.2v2.134h3.2V8.033zm0-1.066h-3.2V4.833h3.2v2.134z" class="vs_foreground"/></svg></svg><span>dbo.Vehicle</span></a></li>
            </ul>
          </div>
        </div>
      </div>
      <div id="UsedBy" class="panel panel-default">
        <div class="panel-heading">
          <span class="icon-bottom inline-middle expanded icon-small"></span>
          <span class="icon-right inline-middle collapsed icon-small" style="display:none"></span>
          <h2 class="inline-middle">Used By</h2>
        </div>
        <div class="panel-collapse collapse in">
          <div class="panel-body">
            <span class="text-muted">No items found</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="footer">
    <div class="col-xs-4">Author:&nbsp;Carlos Humberto Peraf&#225;n S&#225;nchez</div>
    <div class="col-xs-4 align-center">Copyright &#169; Navisaf SAS</div>
    <div class="col-xs-4 align-right">Created:&nbsp;10/07/2024</div>
  </div>
</body>
</html>